┌─────────────────────────────────────────────────────────────────────┐
│                           Class Diagram                             │
└─────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────┐
│        QAService             │  ◄─── Singleton (qa_service)
├──────────────────────────────┤
│ - qa_chain: RetrievalQA      │
│ - _initialized: bool         │
├──────────────────────────────┤
│ + initialize(): void         │
│ + ask(question): Dict        │
│ + health_check(): Dict       │
└──────────┬───────────────────┘
           │ Composition
           │
    ┌──────┴─────┬────────────────┐
    │            │                │
    ▼            ▼                ▼
┌─────────┐  ┌────────────────┐  ┌─────────────┐
│Embedding│  │RerankerRetriever│ │  LlamaCpp   │
├─────────┤  ├────────────────┤  ├─────────────┤
│• model  │  │• vectorstore   │  │• model_path │
│         │  │• reranker      │  │• n_ctx      │
│+ embed()│  │• initial_k     │  │• n_threads  │
└─────────┘  │• final_k       │  │             │
             │                │  │+ __call__() │
             │+ _get_relevant │  └─────────────┘
             │  _documents()  │
             └────────┬───────┘
                      │ Inherits
                      ▼
            ┌──────────────────┐
            │  BaseRetriever   │  ◄─── LangChain abstract base
            │  (LangChain)     │
            └──────────────────┘


┌────────────────────────────────────────────────────────────────┐
│                        API Data Models                         │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌──────────────┐        ┌──────────────┐                     │
│  │ChatRequest   │        │ChatResponse  │                     │
│  ├──────────────┤        ├──────────────┤                     │
│  │+ message: str│───────▶│+ answer: str │                     │
│  │+ include_... │        │+ sources:[]  │                     │
│  └──────────────┘        └──────────────┘                     │
│                                  │                             │
│                                  │ contains                    │
│                                  ▼                             │
│                          ┌──────────────┐                     │
│                          │   Source     │                     │
│                          ├──────────────┤                     │
│                          │+ content:str │                     │
│                          │+ source: str │                     │
│                          │+ page: int?  │                     │
│                          └──────────────┘                     │
└────────────────────────────────────────────────────────────────┘
